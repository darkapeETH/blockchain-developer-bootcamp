{"ast":null,"code":"import { createSelector } from 'reselect';\nimport { get, groupBy } from 'lodash';\nimport { ethers } from 'ethers';\nimport moment from 'moment';\nconst tokens = state => get(state, 'tokens.contracts');\nconst allOrders = state => get(state, 'exchange.allOrders.data', []);\nconst GREEN = '#25CE8F';\nconst RED = '#F45353';\nconst decorateOrder = (order, tokens) => {\n  let token0Amount, token1Amount;\n  if (order.tokenGive === tokens[1].address) {\n    token0Amount = order.amountGive;\n    token1Amount = order.amountGet;\n  } else {\n    token0Amount = order.amountGet;\n    token1Amount = order.amountGive;\n  }\n  const precision = 100000;\n  let tokenPrice = token1Amount / token0Amount;\n  tokenPrice = Math.round(tokenPrice * precision) / precision;\n  return {\n    ...order,\n    token0Amount: ethers.utils.formatUnits(token0Amount, 'ether'),\n    token1Amount: ethers.utils.formatUnits(token1Amount, 'ether'),\n    tokenPrice,\n    formattedTimestamp: moment.unix(order.timestamp).format('h:mm:ssa d MMM D')\n  };\n};\n\n//Order Book\nexport const orderBookSelector = createSelector(allOrders, tokens, (orders, tokens) => {\n  if (!tokens[0] || !tokens[1]) {\n    return;\n  }\n  orders = orders.filter(o => o.tokenGet === tokens[0].address || o.tokenGet === tokens[1].address);\n  orders = orders.filter(o => o.tokenGive === tokens[0].address || o.tokenGive === tokens[1].address);\n\n  //Decorate the orders\n  orders = decorateOrderBookOrders(orders, tokens);\n\n  //Group ordes by orderType\n  orders = groupBy(orders, 'orderType');\n\n  //Sort Buy orders by highest token price\n  const buyOrders = get(orders, 'buy', []);\n  orders = {\n    ...orders,\n    buyOrders: buyOrders.sort((a, b) => b.tokenPrice - a.tokenPrice)\n  };\n\n  //Sort Sell orders by Highest token price\n  const sellOrders = get(orders, 'sell', []);\n  orders = {\n    ...orders,\n    sellOrders: sellOrders.sort((a, b) => b.tokenPrice - a.tokenPrice)\n  };\n  return orders;\n});\nconst decorateOrderBookOrders = (orders, tokens) => {\n  return orders.map(order => {\n    order = decorateOrder(order, tokens);\n    order = decorateOrderBookOrder(order, tokens);\n    return order;\n  });\n};\nconst decorateOrderBookOrder = (order, tokens) => {\n  const orderType = order.tokenGive === tokens[1].address ? 'buy' : 'sell';\n  return {\n    ...order,\n    orderType,\n    orderTypeClass: orderType === 'buy' ? GREEN : RED,\n    orderFillAction: orderType === 'buy' ? 'sell' : 'buy'\n  };\n};","map":{"version":3,"names":["createSelector","get","groupBy","ethers","moment","tokens","state","allOrders","GREEN","RED","decorateOrder","order","token0Amount","token1Amount","tokenGive","address","amountGive","amountGet","precision","tokenPrice","Math","round","utils","formatUnits","formattedTimestamp","unix","timestamp","format","orderBookSelector","orders","filter","o","tokenGet","decorateOrderBookOrders","buyOrders","sort","a","b","sellOrders","map","decorateOrderBookOrder","orderType","orderTypeClass","orderFillAction"],"sources":["/mnt/c/pr0/blockchain-developer-bootcamp/src/store/selectors.js"],"sourcesContent":["import { createSelector } from 'reselect'\r\nimport { get, groupBy} from 'lodash'\r\n\r\nimport { ethers } from 'ethers'\r\nimport moment from 'moment'\r\n\r\nconst tokens = state => get(state, 'tokens.contracts')\r\nconst allOrders = state => get(state, 'exchange.allOrders.data', [])\r\n\r\nconst GREEN = '#25CE8F'\r\nconst RED = '#F45353'\r\n\r\nconst decorateOrder =  (order, tokens) => {\r\n\tlet token0Amount, token1Amount\r\n\r\n\tif (order.tokenGive === tokens[1].address) {\r\n\t\ttoken0Amount = order.amountGive\r\n\t\ttoken1Amount = order.amountGet\r\n\t} else {\r\n\t\ttoken0Amount = order.amountGet\r\n\t\ttoken1Amount = order.amountGive\t\t\r\n\t}\r\n\tconst precision = 100000\r\n\tlet tokenPrice = (token1Amount / token0Amount)\r\n\ttokenPrice = Math.round(tokenPrice * precision) / precision\r\n\r\n\treturn ({\r\n\t\t...order,\r\n\t\ttoken0Amount: ethers.utils.formatUnits(token0Amount,'ether'),\r\n\t\ttoken1Amount: ethers.utils.formatUnits(token1Amount,'ether'),\r\n\t\ttokenPrice,\r\n\t\tformattedTimestamp: moment.unix(order.timestamp).format('h:mm:ssa d MMM D')\r\n\t})\r\n}\r\n\r\n//Order Book\r\nexport const orderBookSelector = createSelector(\r\n\tallOrders,\r\n\ttokens,\r\n\t(orders, tokens) =>{\r\n\t\tif (!tokens[0] || !tokens[1]) {return}\r\n\r\n\t\torders = orders.filter((o) => o.tokenGet === tokens[0].address || o.tokenGet === tokens[1].address)\r\n\t\torders = orders.filter((o) => o.tokenGive === tokens[0].address || o.tokenGive === tokens[1].address)\r\n\r\n\t//Decorate the orders\r\n\torders = decorateOrderBookOrders(orders, tokens)\r\n\r\n\t//Group ordes by orderType\r\n\torders = groupBy(orders, 'orderType')\r\n\r\n\t//Sort Buy orders by highest token price\r\n\tconst buyOrders = get(orders, 'buy', [])\r\n\torders = {\r\n\t\t...orders,\r\n\t\tbuyOrders: buyOrders.sort((a, b) => b.tokenPrice - a.tokenPrice)\r\n\t}\r\n\r\n\t//Sort Sell orders by Highest token price\r\n\tconst sellOrders = get(orders, 'sell', [])\r\n\torders = {\r\n\t\t...orders,\r\n\t\tsellOrders: sellOrders.sort((a, b) => b.tokenPrice - a.tokenPrice)\r\n\t}\r\n\treturn orders\r\n}) \r\n\r\nconst decorateOrderBookOrders = (orders, tokens) => {\r\n\treturn(\r\n\t\torders.map((order) => {\r\n\t\t\torder = decorateOrder(order, tokens)\r\n\t\t\torder = decorateOrderBookOrder(order, tokens)\r\n\t\t\treturn(order)\r\n\t\t})\r\n\t)\r\n}\r\n\r\nconst decorateOrderBookOrder = (order, tokens) => {\r\n\tconst orderType = order.tokenGive === tokens[1].address ? 'buy' : 'sell'\r\n\r\n\treturn ({\r\n\t\t...order,\r\n\t\torderType,\r\n\t\torderTypeClass: (orderType === 'buy') ? GREEN : RED,\r\n\t\torderFillAction: (orderType === 'buy' ? 'sell' : 'buy')\r\n\t})\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}