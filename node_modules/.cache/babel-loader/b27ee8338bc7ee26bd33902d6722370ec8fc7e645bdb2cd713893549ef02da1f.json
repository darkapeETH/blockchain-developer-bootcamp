{"ast":null,"code":"import { createSelector } from 'reselect';\nimport { get } from 'lodash';\nimport { ethers } from 'ethers';\nimport moment from 'moment';\nconst tokens = state => get(state, 'tokens.contracts');\nconst allOrders = state => get(state, 'exchange.allOrders.data', []);\nconst decorateOrder = (order, tokens) => {\n  let token0Amount, token1Amount;\n  if (order.tokenGive === tokens[1].address) {\n    token0Amount = order.amountGive;\n    token1Amount = order.amountGet;\n  } else {\n    token0Amount = order.amountGet;\n    token1Amount = order.amountGive;\n  }\n  const precision = 100000;\n  let tokenPrice = token1Amount / token0Amount;\n  tokenPrice = Math.round(tokenPrice * precision) / precision;\n  return {\n    ...order,\n    token0Amount: ethers.utils.formatUnits(token0Amount, 'ether'),\n    token1Amount: ethers.utils.formatUnits(token1Amount, 'ether'),\n    tokenPrice,\n    formattedTimestamp: moment.unix(order.timestamp).format('h:mm:ssa d MMM D')\n  };\n};\n\n//Order Book\nexport const orderBookSelector = createSelector(allOrders, tokens, (orders, tokens) => {\n  if (!tokens[0] || !tokens[1]) {\n    return;\n  }\n  orders = orders.filter(o => o.tokenGet === tokens[0].address || o.tokenGet === tokens[1].address);\n  orders = orders.filter(o => o.tokenGive === tokens[0].address || o.tokenGive === tokens[1].address);\n\n  //Decorate the orders\n  orders = decorateOrderBookOrders(orders, tokens);\n  console.log(orders);\n});\nconst decorateOrderBookOrders = (orders, tokens) => {\n  return orders.map(order => {\n    order = decorateOrder(order, tokens);\n    order = decorateOrderBookOrder(order, tokens);\n    return order;\n  });\n};\nconst GREEN = '#25CE8F';\nconst RED = '#F45353';\nconst decorateOrderBookOrder = (order, tokens) => {\n  const orderType = order.tokenGive === tokens[1].address ? 'buy' : 'sell';\n  return {\n    ...order,\n    orderType,\n    orderTypeClass: orderType === 'buy' ? GREEN : RED\n  };\n};","map":{"version":3,"names":["createSelector","get","ethers","moment","tokens","state","allOrders","decorateOrder","order","token0Amount","token1Amount","tokenGive","address","amountGive","amountGet","precision","tokenPrice","Math","round","utils","formatUnits","formattedTimestamp","unix","timestamp","format","orderBookSelector","orders","filter","o","tokenGet","decorateOrderBookOrders","console","log","map","decorateOrderBookOrder","GREEN","RED","orderType","orderTypeClass"],"sources":["/mnt/c/pr0/blockchain-developer-bootcamp/src/store/selectors.js"],"sourcesContent":["import { createSelector } from 'reselect'\r\nimport { get } from 'lodash'\r\nimport { ethers } from 'ethers'\r\nimport moment from 'moment'\r\n\r\nconst tokens = state => get(state, 'tokens.contracts')\r\nconst allOrders = state => get(state, 'exchange.allOrders.data', [])\r\nconst decorateOrder =  (order, tokens) => {\r\n\tlet token0Amount, token1Amount\r\n\r\n\tif (order.tokenGive === tokens[1].address) {\r\n\t\ttoken0Amount = order.amountGive\r\n\t\ttoken1Amount = order.amountGet\r\n\t} else {\r\n\t\ttoken0Amount = order.amountGet\r\n\t\ttoken1Amount = order.amountGive\t\t\r\n\t}\r\n\tconst precision = 100000\r\n\tlet tokenPrice = (token1Amount / token0Amount)\r\n\ttokenPrice = Math.round(tokenPrice * precision) / precision\r\n\r\n\treturn ({\r\n\t\t...order,\r\n\t\ttoken0Amount: ethers.utils.formatUnits(token0Amount,'ether'),\r\n\t\ttoken1Amount: ethers.utils.formatUnits(token1Amount,'ether'),\r\n\t\ttokenPrice,\r\n\t\tformattedTimestamp: moment.unix(order.timestamp).format('h:mm:ssa d MMM D')\r\n\t})\r\n}\r\n\r\n//Order Book\r\nexport const orderBookSelector = createSelector(\r\n\tallOrders,\r\n\ttokens,\r\n\t(orders, tokens) =>{\r\n\t\tif (!tokens[0] || !tokens[1]) {return}\r\n\r\n\t\torders = orders.filter((o) => o.tokenGet === tokens[0].address || o.tokenGet === tokens[1].address)\r\n\t\torders = orders.filter((o) => o.tokenGive === tokens[0].address || o.tokenGive === tokens[1].address)\r\n\r\n\t//Decorate the orders\r\n\torders = decorateOrderBookOrders(orders, tokens)\r\n\tconsole.log(orders)\r\n\t\r\n}) \r\n\r\nconst decorateOrderBookOrders = (orders, tokens) => {\r\n\treturn(\r\n\t\torders.map((order) => {\r\n\t\t\torder = decorateOrder(order, tokens)\r\n\t\t\torder = decorateOrderBookOrder(order, tokens)\r\n\t\t\treturn(order)\r\n\t\t})\r\n\t)\r\n}\r\n\r\nconst GREEN = '#25CE8F'\r\nconst RED = '#F45353'\r\n\r\nconst decorateOrderBookOrder = (order, tokens) => {\r\n\tconst orderType = order.tokenGive === tokens[1].address ? 'buy' : 'sell'\r\n\r\n\treturn ({\r\n\t\t...order,\r\n\t\torderType,\r\n\t\torderTypeClass: (orderType === 'buy') ? GREEN : RED\r\n\t})\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}